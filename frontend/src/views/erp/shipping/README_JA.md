# 出荷管理モジュール ページ・コンポーネント説明書（日本語）

本ドキュメントは `frontend/src/views/erp/shipping` フォルダ内の全ページおよびコンポーネントの機能・構成を日本語で詳細に説明します。

---

## 目次

1. [フォルダ構成](#1-フォルダ構成)
2. [ページ（ビュー）一覧](#2-ページビュー一覧)
3. [コンポーネント一覧](#3-コンポーネント一覧)

---

## 1. フォルダ構成

```
shipping/
├── README_JA.md                    # 本説明書
├── ShippingList.vue                # 出荷構成表管理（メイン一覧）
├── ShippingListPage.vue            # 出荷確認リスト
├── ShippingOverview.vue            # 出荷予定表
├── ShippingReportPage.vue          # 出荷報告書
├── ShippingPickingHome.vue         # ピッキング管理（ホーム）
├── WeldingShippingManager.vue     # スライディング溶接出荷管理
├── InventoryShortageManagement.vue # 在庫不足管理
├── ShippingCreateDialog.vue       # 出荷No作成ダイアログ
├── ShippingDetailDialog.vue        # 出荷番号詳細ダイアログ
└── components/
    ├── PickingHistory.vue          # ピッキング履歴分析
    ├── PickingListGenerator.vue    # ピッキングリスト
    ├── PickingProgress.vue         # ピッキング進捗管理
    ├── DestinationGroupManager.vue # 納入先グループ管理
    ├── ShippingCalendarDialog.vue  # 出荷カレンダー（予定表・リスト印刷）
    ├── ShippingOverviewPrint.vue   # 出荷予定表印刷用テンプレート
    ├── ShippingListReport.vue       # 出荷確認リスト印刷用テンプレート
    ├── ShippingReport.vue           # 出荷報告書印刷用テンプレート
    ├── PrintHistoryDialog.vue       # 印刷履歴管理ダイアログ
    ├── ShippingQuickEditDialog.vue  # 数量・箱数クイック編集
    └── FileWatcherManager.vue       # ファイル監視器管理
```

---

## 2. ページ（ビュー）一覧

### 2.1 ShippingList.vue — 出荷構成表管理

| 項目 | 内容 |
|------|------|
| **ルート** | `/erp/shipping`（名前: `Shipping`） |
| **メニュー** | 出荷管理 > 出荷構成表管理 |
| **役割** | 出荷構成表（出荷No・納入先・製品・数量など）の一覧表示・検索・作成・編集・削除・印刷の中心画面 |

**主な機能**

- **フィルター**
  - 期間（日付範囲）、グループ、納入先（単一選択・クイックボタン）で絞り込み
  - 納入先グループ管理ボタンでグループの編集が可能
  - 選択中グループの表示と「全てクリア」

- **操作ボタン**
  - **出荷構成表作成**: `ShippingCreateDialog` を開き、受注データから出荷Noを新規作成
  - **選択印刷**: 選択した行の出荷データを印刷
  - **選択削除**: 選択した出荷の削除（確認あり）
  - **列表示設定**: テーブル列の表示/非表示を設定
  - **ピッキング出力**: ピッキング用データの出力

- **テーブル**
  - 出荷番号、出荷日、納入日、納入先、製品、箱数・数量、状態など
  - 行クリックで `ShippingDetailDialog` を開き詳細表示・編集
  - 複数選択可能（チェックボックス）

- **その他**
  - ページング、ソート、ローディング表示
  - `ShippingQuickEditDialog` を呼び出すクイック編集の導線がある場合あり

---

### 2.2 ShippingListPage.vue — 出荷確認リスト

| 項目 | 内容 |
|------|------|
| **ルート** | `/erp/shipping/confirm`（名前: `ShippingListPage`） |
| **メニュー** | 出荷管理 > 出荷確認リスト |
| **役割** | 出荷日・納入先で絞り込んだ「出荷確認リスト」の表示と、グループ別（オワリ便・社内便等）の印刷 |

**主な機能**

- **出荷カレンダー**
  - `ShippingCalendarDialog` をインライン表示（`report-type="list"`）
  - 月単位で出荷データの有無を表示し、日付・グループ別に印刷ボタンを表示

- **フィルター**
  - 出荷日（日付範囲）、前日/今日/翌日ボタン
  - 納入先（複数選択）、グループ管理ボタン
  - グループ選択（ラジオ）: 全て / 各納入先グループ

- **統計**
  - 納入先数、出荷日数、製品種類、総箱数

- **テーブル**
  - 納入先でグループ化した表示（グループヘッダー行あり）
  - No、出荷日、納入先、出荷No、製品名、箱数など
  - 合計行（summary）

- **印刷**
  - 条件に合うデータを「出荷確認リスト」として印刷（`ShippingListReport` 等を利用）

---

### 2.3 ShippingOverview.vue — 出荷予定表

| 項目 | 内容 |
|------|------|
| **ルート** | `/erp/shipping/overview`（名前: `ShippingOverview`） |
| **メニュー** | 出荷管理 > 出荷予定表発行 |
| **役割** | 出荷予定の一覧表示と、グループ別の「出荷予定表」印刷 |

**主な機能**

- **出荷カレンダー**
  - `ShippingCalendarDialog` をインライン表示（`report-type="schedule"`）
  - 予定表用のグループ別印刷（オワリ便・吉良・社内便等）

- **フィルター**
  - 出荷日（日付範囲）、前日/今日/翌日
  - 納入先（複数選択）、グループ管理、グループ選択（ラジオ）
  - リセット・印刷ボタン

- **統計**
  - 納入先数、出荷日数、製品種類、総箱数（ガラス風カード表示）

- **テーブル**
  - 納入先でグループ化、出荷日・納入先・出荷No・製品名・箱数等
  - 合計行、セル結合（span）

- **印刷**
  - 出荷予定表として印刷（`ShippingOverviewPrint` を利用）

---

### 2.4 ShippingReportPage.vue — 出荷報告書

| 項目 | 内容 |
|------|------|
| **ルート** | `/erp/shipping/report`（名前: `ShippingReport`） |
| **メニュー** | 出荷管理 > 出荷報告書管理 |
| **役割** | 営業報告用「出荷報告書」の条件指定・プレビュー・印刷と印刷履歴の確認 |

**主な機能**

- **出荷カレンダー**
  - `ShippingCalendarDialog` をインライン表示（営業報告用）

- **フィルター**
  - 出荷日（日付範囲）、納入先（複数）、グループ管理・グループ選択
  - **印刷履歴**: `PrintHistoryDialog` を開き、過去の印刷履歴を検索・一括削除
  - **報告書印刷**: 出荷報告書の印刷実行

- **統計**
  - 納入先数、出荷日数、製品種類、総箱数

- **テーブル**
  - 納入先グループヘッダー付き、出荷日・納入先・出荷No・製品名・箱数等
  - 合計行

- **印刷**
  - 出荷品報告書フォーマット（`ShippingReport` コンポーネント）で印刷

---

### 2.5 ShippingPickingHome.vue — ピッキング管理（ホーム）

| 項目 | 内容 |
|------|------|
| **ルート** | `/erp/shipping/picking`（名前: `ShippingPickingHome`） |
| **メニュー** | 出荷管理 > ピッキング管理 |
| **役割** | 出荷ピッキングのダッシュボード。本日のパレット数・進捗・完了率を表示し、ピッキングリスト・進捗・履歴のタブを提供 |

**主な機能**

- **ヘッダー**
  - タイトル「出荷ピッキング管理」、サブタイトル
  - **データベース初期化**: ピッキング用DBの初期化
  - **データ同期**: 出荷データをピッキング用に同期（`syncShippingDataToPickingTasks`）

- **本日サマリーカード（4枚）**
  - 今日ピッキングパレット数
  - 今日作業中（進行中）
  - 今日完了
  - 今日完了率（円形プログレス）

- **タブ「管理パネル」**
  - **ピッキングリスト**: `PickingListGenerator` — パレット一覧・リスト印刷
  - **進捗管理**: `PickingProgress` — リアルタイム進捗・完了操作
  - **履歴・分析**: `PickingHistory` — 期間別の履歴と完了率分析

- **データ取得**
  - `/api/shipping/picking/new-progress` で本日サマリー・パレット一覧等を取得
  - 製品名に「加工」「アーチ」「料金」を含むデータは表示から除外する処理あり

---

### 2.6 WeldingShippingManager.vue — スライディング溶接出荷管理

| 項目 | 内容 |
|------|------|
| **ルート** | `/erp/shipping/welding`（名前: `WeldingShippingManager`） |
| **メニュー** | 出荷管理 > 溶接出荷管理 |
| **役割** | スライディング溶接製品に特化した出荷予定の期間・製品別検索と、出荷予定表の印刷用出力 |

**主な機能**

- **検索条件カード**
  - 期間（日付範囲、ショートカットあり）
  - 対象製品（溶接製品の複数選択）
  - 検索実行・リセット

- **データカード（検索後表示）**
  - 統計: 対象期間、対象製品数、総レコード数
  - **印刷用出力**: 出荷予定表を印刷用にエクスポート

- **テーブル**
  - 納入先×日付のピボット形式（溶接製品の出荷スケジュール詳細）
  - セル結合（objectSpanMethod）で見やすく表示

---

### 2.7 InventoryShortageManagement.vue — 在庫不足管理

| 項目 | 内容 |
|------|------|
| **ルート** | `/erp/shipping/inventory-shortage`（名前: `InventoryShortageManagement`） |
| **メニュー** | 出荷管理 > 在庫不足管理 |
| **役割** | 日付・製品別の受注・内示・安全在庫・現在在庫を一覧し、在庫不足（マイナス在庫）の把握と一括更新 |

**主な機能**

- **ヘッダー**
  - 推移グラフボタン（チャートダイアログ）、印刷、**全部一括更新**

- **フィルター**
  - 期間設定（日付範囲）、前日/今日/後日
  - 製品選択、「在庫がマイナスのみ表示」チェック

- **統計カード**
  - 現在在庫数、安全在庫数、在庫不足数（マイナス合計）

- **テーブル**
  - 日付、曜日、製品CD、製品名、受注数、内示数、安全在庫、現在在庫等
  - 在庫不足のハイライト、合計行、ページネーション

- **一括更新**
  - 表示データに基づき安全在庫・在庫数等を一括で更新する処理

---

### 2.8 ShippingCreateDialog.vue — 出荷No作成ダイアログ

| 項目 | 内容 |
|------|------|
| **呼び出し元** | `ShippingList.vue`（「出荷構成表作成」ボタン） |
| **役割** | 受注データから出荷Noを新規作成する大型ダイアログ（左右プール形式） |

**主な機能**

- **レイアウト**
  - 左: 受注データ一覧（出荷日・日付範囲フィルター、追加条件）
  - 右: 出荷対象として選択したデータ（出荷No付与前の候補）
  - ヘッダーに「出荷Noを保存」ボタン

- **左プール（受注データ）**
  - 出荷日・日付範囲、検索・フィルター
  - 一覧から行を選択して右へ追加（または一括追加）
  - 利用可能件数の表示

- **右プール**
  - 納入先・出荷日等でグループ化して表示
  - 行の削除、並び替え
  - 出荷Noのプレフィックス・連番の設定（保存時に確定）

- **保存**
  - 出荷Noを付与して保存し、親画面の一覧を更新

---

### 2.9 ShippingDetailDialog.vue — 出荷番号詳細ダイアログ

| 項目 | 内容 |
|------|------|
| **呼び出し元** | `ShippingList.vue`（テーブル行クリック） |
| **役割** | 指定した出荷番号に紐づく全製品の詳細表示と、基本情報・数量の編集 |

**主な機能**

- **出荷情報カード**
  - 出荷番号（サフィックス部分のインライン編集可）、状態、製品件数
  - 出荷日、納入日、納入先、合計数量

- **製品一覧テーブル**
  - 製品CD、製品名、箱数、数量、納入日等
  - **一括編集**: 複数行の数量・箱数等を一括で変更し保存
  - 保存・キャンセルで一括編集モードを終了

- **その他**
  - 出荷番号の変更（プレフィックス固定・サフィックスのみ編集）、状態タグ表示

---

## 3. コンポーネント一覧

### 3.1 PickingHistory.vue — ピッキング履歴分析

| 項目 | 内容 |
|------|------|
| **使用箇所** | `ShippingPickingHome.vue` の「履歴・分析」タブ |
| **役割** | 期間を指定してピッキング履歴を集計し、完了率・トレンドを分析 |

**主な機能**

- **検索条件**
  - 期間（日付範囲）、昨日/今日/明日、先月/今月/来月のクイックボタン
  - 担当者別納入先グループ管理（`DestinationGroupManager` の別用途）
  - 検索・リセット

- **統計カード（4枚）**
  - 総ピッキング数、総未ピッキング数、総ピッキング済数、全体完了率

- **チャート**
  - 期間内の日別・担当者別などの完了率・件数トレンド（グラフカード）

- **テーブル・一覧**
  - ピッキングタスクの一覧、状態、完了日時等の分析用表示

---

### 3.2 PickingListGenerator.vue — ピッキングリスト

| 項目 | 内容 |
|------|------|
| **使用箇所** | `ShippingPickingHome.vue` の「ピッキングリスト」タブ |
| **役割** | 出荷日・状態・製品で絞り込んだパレット一覧の表示と、ピッキングリストの印刷 |

**主な機能**

- **ヘッダー**
  - **データ読み込み**: 出荷データをピッキング用に同期（DB取り込み）
  - **データ更新**: 一覧の再取得

- **統計カード**
  - パレット数、未ピッキング、ピッキング済、完成率

- **フィルター**
  - 出荷日（日付範囲、前日/今日/翌日）、状態（未ピッキング/ピッキング済）、製品
  - 検索・リセット・印刷

- **パレット一覧テーブル**
  - パレット番号（出荷No）、出荷日、状態、製品等
  - 25件ごとのページネーション
  - 印刷ボタンでピッキングリストを印刷

- **空状態**
  - データがない場合は「データ読み込み」を促すメッセージとボタン

---

### 3.3 PickingProgress.vue — ピッキング進捗管理

| 項目 | 内容 |
|------|------|
| **使用箇所** | `ShippingPickingHome.vue` の「進捗管理」タブ |
| **役割** | 当日のピッキング進捗をリアルタイムで表示し、完了操作や進捗推移を管理 |

**主な機能**

- **ヘッダー**
  - タイトル「ピッキング進捗管理」、データ更新ボタン

- **本日の概要カード（3枚）**
  - 総ピッキングパレット数、未ピッキング、完了済み

- **チャートエリア**
  - **今日の進捗状況**: 円形プログレスで完成率、完了済み/作業中の内訳
  - **進捗推移トレンド**: 過去7日〜未来3日などの推移（折れ線等）

- **パレット一覧・操作**
  - 本日のパレット一覧、状態（未ピッキング/ピッキング済）
  - 行ごとの「完了」操作でピッキング済に更新
  - 更新後に親の `refreshStats` を呼び出してサマリーを再取得

---

### 3.4 DestinationGroupManager.vue — 納入先グループ管理

| 項目 | 内容 |
|------|------|
| **使用箇所** | `ShippingCalendarDialog` 内、および出荷確認リスト・出荷予定表・出荷報告書等の「グループ」ボタン |
| **役割** | 納入先を複数グループに振り分け、オワリ便・社内便・吉良等の印刷グループを管理 |

**主な機能**

- **利用可能な納入先**
  - マスタから取得した納入先をタグ表示
  - ドラッグ＆ドロップ（またはタッチ長押し）でグループへ追加

- **グループ管理**
  - 複数グループをカード表示、各グループに納入先タグをドロップ
  - グループ名の編集（ダブルクリックまたは編集ボタン）
  - クリア（グループ内の納入先を空にする）、削除（グループ自体を削除）
  - 新規グループ作成（サブダイアログ）

- **保存・一括割当**
  - 保存でグループ構成をAPIに保存
  - 「一键分配」で内示タイプ等に応じた自動振り分け（実装による）

---

### 3.5 ShippingCalendarDialog.vue — 出荷カレンダー

| 項目 | 内容 |
|------|------|
| **使用箇所** | 出荷予定表・出荷確認リスト・出荷報告書ページにインライン、またはダイアログとして単体利用 |
| **役割** | 月間カレンダー上で日付別・納入先グループ別に出荷データの有無を表示し、グループごとに印刷実行 |

**主な機能**

- **表示モード**
  - **inline**: ページ内に直接表示（予定表・リスト・報告書の各ページ）
  - **ダイアログ**: 別ウィンドウで開く

- **カレンダー**
  - 前月/今月/来月で月切り替え
  - 各日付セルに、その日の出荷データがある場合はグループ別ボタンを表示
  - ボタンラベルはグループ名（「オワリ便」「社内便」等）、印刷済の日は「済」バッジ

- **report-type**
  - `schedule`: 出荷予定表用（全グループ表示）
  - `list`: 出荷確認リスト用（リスト対象グループのみ表示する等の制御）

- **印刷**
  - 日付＋グループを指定して印刷（予定表またはリストの該当データのみ）
  - 印刷履歴と連携し「済」表示を更新

- **グループ管理**
  - 「グループ管理」ボタンで `DestinationGroupManager` を開く

---

### 3.6 ShippingOverviewPrint.vue — 出荷予定表（印刷用）

| 項目 | 内容 |
|------|------|
| **使用箇所** | `ShippingOverview.vue` または `ShippingCalendarDialog` から印刷プレビュー・印刷時にレンダリング |
| **役割** | 出荷予定表の印刷用レイアウト（日付別・納入先別、2カラム等）を提供 |

**主な機能**

- **レイアウト**
  - 印刷日時・出荷日をヘッダーに表示
  - 出荷日ごとにブロック、納入先ごとに表（製品名、数量、出荷No、確認欄）
  - 複数納入先は2カラムでページ内に収める等のレイアウト
  - 日付は JST で「YYYY/MM/DD 曜」形式

- **データ**
  - props: `data`（出荷予定一覧）、`filters`
  - 出荷日→納入先でグループ化し、ページネーション付きで複数ページに対応

---

### 3.7 ShippingListReport.vue — 出荷確認リスト（印刷用）

| 項目 | 内容 |
|------|------|
| **使用箇所** | `ShippingListPage.vue` から印刷時にレンダリング |
| **役割** | 「出荷品リスト」の印刷用レイアウト（納入先別、出荷NO・製品名・箱タイプ・受注数等） |

**主な機能**

- **ヘッダー**
  - 出荷日（日付範囲）、中央に「出荷品リスト」、印刷日時

- **納入先セクション**
  - 納入先名、表（出荷NO、製品名、製品種類、箱タイプ、バレNO、受注数、受注本数、納入日）
  - 納入先ごとの合計（受注箱数、受注本数、出荷パレ数）

- **データ**
  - props: `data`（リスト用アイテム配列）、`filters.dateRange`

---

### 3.8 ShippingReport.vue — 出荷報告書（印刷用）

| 項目 | 内容 |
|------|------|
| **使用箇所** | `ShippingReportPage.vue` から印刷プレビュー・印刷時にレンダリング |
| **役割** | 「出荷品報告書」の印刷用レイアウト。納入先別に表と合計を表示し、ページ区切り・最適化率表示に対応 |

**主な機能**

- **ヘッダー**
  - 出荷日、タイトル「出荷品報告書」、印刷日時
  - 複数ページ時は2ページ目以降にもヘッダーを付与

- **納入先セクション**
  - 出荷No、製品名、製品種類、箱タイプ、受注数、受注本数、納入日
  - 納入先合計（受注箱数、受注本数、出荷パレ数）
  - ページ区切り（needPageBreak）で改ページ

- **プレビュー用情報**
  - 総ページ数、納入先数、最適化率（showPaginationInfo 時）

---

### 3.9 PrintHistoryDialog.vue — 印刷履歴管理ダイアログ

| 項目 | 内容 |
|------|------|
| **使用箇所** | `ShippingReportPage.vue` の「印刷履歴」ボタン等 |
| **役割** | 出荷レポート・出荷カレンダー等の印刷履歴の検索・一覧表示・一括削除 |

**主な機能**

- **フィルター**
  - レポート種別（出荷レポート、出荷カレンダー、その他）、ユーザー名、印刷日（日付範囲）
  - 検索・リセット

- **統計**
  - 総印刷数、成功/失敗/キャンセル件数

- **テーブル**
  - ID、レポート種別、レポートタイトル、印刷日時、ユーザー、状態等
  - 複数行選択で一括削除

---

### 3.10 ShippingQuickEditDialog.vue — 数量・箱数クイック編集

| 項目 | 内容 |
|------|------|
| **使用箇所** | 出荷一覧などで、行のクイック編集から呼び出し |
| **役割** | 単一の出荷明細について、製品名・納入日・箱数・数量を素早く編集 |

**主な機能**

- **読み取り専用表示**
  - 出荷番号、製品CD

- **編集フォーム**
  - 製品名、納入日、箱数（confirmed_boxes）、数量（confirmed_units）
  - 保存でAPIに送信し、親の一覧を更新

---

### 3.11 FileWatcherManager.vue — ファイル監視器管理

| 項目 | 内容 |
|------|------|
| **使用箇所** | 出荷まわりでファイル取り込みを監視する設定画面として利用（ルートは要確認） |
| **役割** | 指定フォルダのファイル監視のON/OFF、最終処理時間・監視パスの表示、監視器の起動・停止の管理 |

**主な機能**

- **ヘッダー**
  - タイトル「ファイル監視器管理システム」、実行中/停止中のステータスバッジ

- **状態カード**
  - 監視パス、最終処理時間、その他監視器の状態表示
  - 更新ボタンで状態を再取得

- **操作**
  - 監視の開始・停止、設定の変更（実装に依存）

---

## 4. ルート・メニュー対応まとめ

| パス | 名前 | メニュー表示名 |
|------|------|----------------|
| `/erp/shipping` | Shipping | 出荷構成表管理 |
| `/erp/shipping/report` | ShippingReport | 出荷報告書管理 |
| `/erp/shipping/overview` | ShippingOverview | 出荷予定表発行 |
| `/erp/shipping/confirm` | ShippingListPage | 出荷確認リスト |
| `/erp/shipping/welding` | WeldingShippingManager | 溶接出荷管理 |
| `/erp/shipping/picking` | ShippingPickingHome | ピッキング管理 |
| `/erp/shipping/inventory-shortage` | InventoryShortageManagement | 在庫不足管理 |

---

## 5. 用語・補足

- **出荷No / 出荷番号**: 1つのパレットまたは出荷単位を識別する番号。プレフィックス＋連番で管理されることが多い。
- **納入先グループ**: オワリ便・社内便・吉良など、印刷・配車単位で納入先をまとめたグループ。
- **ピッキング**: 出荷に必要な製品を倉庫から取りまとめる作業。本モジュールでは「未ピッキング」「ピッキング済」の状態で進捗を管理。
- **出荷予定表**: 日付・納入先別の出荷予定一覧。グループ別に印刷して現場で利用。
- **出荷確認リスト**: 出荷品の確認用リスト。出荷確認リストページで日付・グループを指定して印刷。
- **出荷報告書**: 営業報告用の出荷品報告書。出荷報告書ページで印刷し、印刷履歴で管理。

---

以上が `frontend/src/views/erp/shipping` フォルダ内の全ページ・コンポーネントの詳細説明です。実装の細部は各 Vue ファイルの `<script>` と API 呼び出しを参照してください。
