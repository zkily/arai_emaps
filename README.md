# Smart-EMAPs (ERP+APS+MES) 統合管理システム

製造業のデジタルトランスフォーメーションを実現する次世代統合管理システムです。ERP（企業資源計画）、APS（先進的計画・スケジューリング）、MES（製造実行システム）をシームレスに連携させ、設計から製造、出荷まで一気通貫のデータフローを構築します。

## 🎯 システム概要

Smart-EMAPsは、製造業における経営資源の最適化、高精度な生産計画、現場の実行と可視化を統合的に実現します。各モジュールが緊密に連携し、リアルタイムなデータ共有により、迅速な意思決定と業務効率の最大化を支援します。

## 🚀 技術スタック

### フロントエンド

| カテゴリ           | 技術                                    |
| ------------------ | --------------------------------------- |
| **フレームワーク** | Vue.js 3 (Composition API)              |
| **言語**           | TypeScript                              |
| **ビルドツール**   | Vite 5.0+                               |
| **状態管理**       | Pinia (永続化対応)                      |
| **ルーティング**   | Vue Router 4                            |
| **UIライブラリ**   | Element Plus 2.5+                       |
| **チャート**       | ECharts 5.4+, Chart.js 4.5+             |
| **国際化**         | Vue I18n 11.2+                          |
| **日時処理**       | Day.js 1.11+                            |
| **その他**         | Axios, XLSX, QRCode, html2canvas, jsPDF |

### バックエンド

| カテゴリ              | 技術                               |
| --------------------- | ---------------------------------- |
| **言語**              | Python 3.14                        |
| **Webフレームワーク** | FastAPI 0.109+                     |
| **ASGIサーバー**      | Uvicorn 0.27+                      |
| **ORM**               | SQLAlchemy 2.0+                    |
| **マイグレーション**  | Alembic 1.13+                      |
| **データベース**      | MySQL 8.0+ (aiomysql, PyMySQL)     |
| **認証**              | JWT (python-jose), Passlib, Bcrypt |
| **バリデーション**    | Pydantic 2.5+, Pydantic Settings   |
| **ロギング**          | Loguru 0.7+                        |
| **テスト**            | Pytest 7.4+, pytest-asyncio        |

### データベース

- **RDBMS**: MySQL 8.0+
- **文字セット**: utf8mb4 (Unicode完全対応)
- **接続**: 非同期接続プール (aiomysql)

## 📁 プロジェクト構造

```
Smart-EMAPs/
├── backend/                    # バックエンド（FastAPI + Python）
│   ├── app/
│   │   ├── core/              # コア機能（設定、DB、セキュリティ、日時処理）
│   │   ├── modules/           # 機能モジュール
│   │   │   ├── auth/          # 認証・認可
│   │   │   ├── erp/           # ERP（販売、購買、在庫、原価、受注）
│   │   │   ├── aps/           # APS（生産計画、スケジューリング）
│   │   │   ├── mes/           # MES（製造実行、品質管理）
│   │   │   ├── master/        # マスタデータ管理
│   │   │   ├── system/        # システム管理
│   │   │   └── websocket/     # WebSocket通信
│   │   ├── models/            # データモデル
│   │   ├── schemas/           # Pydanticスキーマ
│   │   └── main.py            # アプリケーションエントリーポイント
│   ├── database/              # データベース初期化スクリプト
│   ├── alembic/               # マイグレーション
│   ├── requirements.txt       # Python依存関係
│   └── .env                   # 環境変数設定
│
├── frontend/                   # フロントエンド（Vue.js 3 + TypeScript）
│   └── src/
│       ├── api/               # APIクライアント
│       ├── components/        # 共通コンポーネント
│       ├── layouts/           # レイアウトコンポーネント
│       ├── router/            # ルーティング設定
│       ├── stores/            # Piniaストア
│       ├── types/             # TypeScript型定義
│       ├── utils/             # ユーティリティ
│       ├── views/             # ページビュー
│       │   ├── erp/           # ERP画面
│       │   ├── aps/           # APS画面
│       │   ├── mes/           # MES画面
│       │   ├── master/        # マスタ管理画面
│       │   └── system/        # システム管理画面
│       ├── App.vue            # ルートコンポーネント
│       └── main.ts            # アプリケーションエントリーポイント
│
├── docs/                       # ドキュメント
│   ├── PROJECT_STRUCTURE.md   # プロジェクト構造詳細
│   └── WEBSOCKET_IMPLEMENTATION.md
│
├── Master/                     # マスタデータファイル
├── logs/                       # ログファイル
├── start.py                    # 統合起動スクリプト
├── start.bat                   # Windows起動スクリプト
├── start.sh                    # Linux/Mac起動スクリプト
└── README.md                   # このファイル
```

詳細なプロジェクト構造については、[docs/PROJECT_STRUCTURE.md](docs/PROJECT_STRUCTURE.md) を参照してください。

## ✨ 主要機能

### 📊 1. ERP：販売管理 (Sales / SD)

顧客からの注文を受け、出荷し、売上を立てるまでのプロセス。

- **見積管理**
  - 見積作成、版数管理、承認ワークフロー
  - 原価積算シミュレーション（過去実績や標準原価に基づいた利益率試算）
- **受注管理**
  - 受注データ登録、EDI取込
  - 内示・フォーキャスト管理（確定前の需要予測をAPSへ連携）
  - 与信管理（受注時の限度額チェック・アラート）
  - 契約単価管理（期間別・数量別ボリュームディスカウント）
- **出荷管理**
  - 出荷指示、ピッキングリスト、分納（分割出荷）管理
  - 預かり在庫出荷（売上計上済み製品の出荷指示）
- **売上・請求管理**
  - 売上計上（出荷基準/検収基準の切替）、請求書発行（インボイス対応）
  - 赤黒訂正処理（返品・値引き時の伝票修正）

### 🛒 2. ERP：購買・外注管理 (Procurement & Subcontracting)

材料の調達だけでなく、協力工場への加工依頼（外注）を強化。

- **発注管理**
  - 発注書発行、承認フロー、納期回答入力（納期遵守率管理）
  - 定期発注・都度発注の自動計算（MRP連携）
- **外注加工管理** (★重要)
  - 有償/無償支給管理（自社材料を外注先に送る処理）
  - 外注加工指示書発行、外注先在庫管理（外注先にある自社資産の把握）
  - 加工費単価管理
- **受入・検収管理**
  - 入荷予定管理、受入登録、受入検査（良品/不良/保留判定）
  - ロット番号付与（トレーサビリティの開始点）
- **債務管理**
  - 請求書照合、支払予定表作成、FBデータ（銀行振込）作成

### 📦 3. ERP：在庫管理 (Inventory / WMS)

「帳簿在庫」と「実在庫」を一致させるための機能。

- **在庫・ロケーション管理**
  - リアルタイム在庫照会、マルチ倉庫・ロケーション管理
  - 有効在庫照会（現在庫 - 引当済 + 入荷予定）
- **入出庫・移動管理**
  - 入出庫履歴、倉庫間移動、セット品組立・分解
  - ロット・トレーサビリティ（正展開：製品→材料、逆展開：材料→製品）
- **棚卸管理**
  - 一斉棚卸、循環棚卸（サイクルカウント）
  - 棚卸差異分析・修正、滞留在庫（デッドストック）アラート

### 🏭 4. ERP：生産管理 (Production Control / PP)

製造の「基準」と「指示」を管理し、APS/MESへつなぐハブ。

- **エンジニアリング（基準情報）**
  - 設計変更(ECO)管理（BOMの版数管理、切替日設定）
  - BOM正展開・逆展開（構成部品検索・使用先検索）
- **生産計画 (ERP側)**
  - MRP (所要量計算)、生産オーダー生成
  - 製番管理（個別受注生産向け：オーダー別原価管理用の番号発行）
- **製造指示**
  - 製造指図書（現品票）発行、材料出庫指示（先入れ先出し）
- **生産実績 (ERP側)**
  - 完成報告（製品入庫）、材料消費実績（バックフラッシュ/実消費）

### 💰 5. ERP：原価・財務連携 (Costing & Finance)

製造現場の活動をお金に換算し、経営判断を支援。

- **原価計算**
  - 標準原価 vs 実際原価の差異分析
  - 配賦計算（労務費・製造経費・光熱費の製品別配賦）
  - 仕掛品(WIP)評価（月末時点の工程内在庫の評価額算出）
- **固定資産管理**
  - 設備台帳、減価償却計算（製造原価への連携）
- **会計連携**
  - 自動仕訳生成（売上・仕入・移動・製造振替）、会計ソフト出力

### 🎯 6. APS：先進的計画・スケジューリング

「いつ・どこで・誰が」作るかを最適化する頭脳。

- **スケジューリング**
  - 有限能力スケジューリング（設備・人の制約を考慮）
  - 段取最適化（色替え、型替えを最小にする順序並べ替え）
  - 緊急割込計画（特急オーダー時の再計算）
- **負荷計画**
  - 山積み・山崩しチャート（負荷調整）、ボトルネック特定
- **シミュレーション**
  - 納期回答シミュレーション、設備故障時の影響分析

### 🖥️ 7. MES：製造実行システム

現場（Shop Floor）の「今」を可視化し、品質を作り込む。

- **製造実行 (Execution)**
  - **電子作業手順書(SOP)** 表示（図面・動画）
  - タブレット実績入力（開始/終了/中断/再開）、作業者スキル認証
- **品質管理 (Quality / QMS)**
  - 工程内検査記録、SPC（統計的工程管理）チャート
  - 不適合品管理 (NC)（不良発生時の処置・原因・対策フロー）
- **設備・保全管理**
  - 金型・治具管理（ショット数管理、所在管理、メンテ期限）
  - 設備稼働監視（信号灯連携）、OEE（設備総合効率）分析
  - アンドン（異常発生時の管理者呼び出し通知）

### ⚙️ 8. 共通基盤・システム管理

システム全体を支えるインフラ機能。

- **マスタデータ管理 (MDM)**
  - カレンダーマスタ（工場カレンダー、シフトパターン）
  - 単位換算マスタ（仕入単位kg → 消費単位g などの変換）
  - 取引先・品目・BOM・工程・設備・社員マスタ
- **システム管理**
  - ロールベース権限管理(RBAC)（5段階権限設定）
  - API連携監視（ERP⇔APS⇔MES間のデータ転送ログ・エラー通知）
  - 多言語・多通貨対応（海外拠点展開用）
  - 監査ログ（誰がいつデータを変更したかの追跡）

## 🔄 システム間連携

### 計画の連鎖 (ERP → APS → MES)

1. **受注登録** (ERP) → 受注情報がAPSに連携
2. **生産計画** (APS) → 需要に基づき最適な生産計画を立案
3. **スケジューリング** (APS) → 詳細な作業スケジュールを生成
4. **作業指示** (MES) → 現場に作業指示を配信

### 実績のフィードバック (MES → APS → ERP)

1. **実績収集** (MES) → 作業実績、品質データをリアルタイム収集
2. **計画調整** (APS) → 実績に基づき計画を動的に再調整
3. **在庫更新** (ERP) → 生産実績に基づき在庫を自動更新
4. **原価計算** (ERP) → 実際原価を計算、差異分析

## 🛠️ セットアップ手順

### 前提条件

- **Node.js**: 18.0以上
- **Python**: 3.10以上
- **MySQL**: 8.0以上

### クイックスタート（推奨）

プロジェクトルートで以下のコマンドを実行すると、バックエンドとフロントエンドを同時に起動できます：

**Windows:**

```bash
start.bat
```

**Linux/Mac:**

```bash
chmod +x start.sh
./start.sh
```

**または直接Pythonスクリプトを実行:**

```bash
python start.py
```

起動スクリプトは以下を自動的に実行します：

- ✅ 環境チェック（Python、Node.js、MySQL）
- ✅ 依存関係の確認とインストール
- ✅ ポートの使用状況確認と解放
- ✅ バックエンドサーバーの起動（ポート: 8005）
- ✅ フロントエンド開発サーバーの起動（ポート: 5000）
- ✅ フロントエンド本番サーバーの起動（ポート: 3005）

起動後、以下のURLでアクセスできます：

- **フロントエンド（開発）**: http://localhost:5000
- **フロントエンド（本番）**: http://localhost:3005
- **バックエンドAPI**: http://localhost:8005
- **APIドキュメント**: http://localhost:8005/docs

### 手動セットアップ

#### 1. データベースの初期化

```bash
# MySQLにログイン
mysql -u root -p

# データベースとユーザーの作成
CREATE DATABASE smart_emap CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'emap_user'@'localhost' IDENTIFIED BY 'emap_password';
GRANT ALL PRIVILEGES ON smart_emap.* TO 'emap_user'@'localhost';
FLUSH PRIVILEGES;

# 初期化スクリプトの実行
mysql -u emap_user -p smart_emap < backend/database/init/01_init.sql
```

#### 2. バックエンドセットアップ

```bash
cd backend

# 仮想環境の作成と有効化
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 依存関係のインストール
pip install -r requirements.txt

# 環境変数の設定
cp env.example .env
# .envファイルを編集してデータベース接続情報を設定

# サーバーの起動
uvicorn app.main:app --host 0.0.0.0 --port 8005 --reload
```

#### 3. フロントエンドセットアップ

```bash
cd frontend

# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# または本番ビルド
npm run build
npm run preview
```

## 🌐 UI/UX デザイン

Smart-EMAPsは、モダンで洗練されたUIデザインを採用しています：

- **グラデーションヘッダー**: 視覚的に美しいグラデーション効果
- **コンパクトレイアウト**: 無駄な空白を削減し、情報密度を最適化
- **レスポンシブデザイン**: デスクトップ、タブレット、モバイルに対応
- **ダークモード対応**: 目に優しいダークテーマ
- **アニメーション**: スムーズなトランジションとマイクロインタラクション
- **アイコン**: Element Plus Iconsによる直感的なアイコン表示

## 🌍 国際化・タイムゾーン

- **タイムゾーン**: 日本標準時（JST, Asia/Tokyo）で統一
- **言語**: 日本語（将来的に多言語対応予定）
- **日時フォーマット**: Day.jsによる柔軟な日時処理
- **ロケール**: Element Plusの日本語ロケール対応

## 📝 ライセンス

このプロジェクトは独自のライセンスの下でライセンスされています。

## 👥 開発チーム

Smart-EMAPs開発チーム

---

**最終更新日時**: 2026年2月9日（日本時間）
