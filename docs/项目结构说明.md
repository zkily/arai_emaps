# Smart-EMAP 项目结构说明

## 一、前后端分类总览

项目严格按**前端 / 后端**划分，根目录下仅保留入口与文档，业务代码全部在 `frontend/` 与 `backend/` 内。

```
Smart-EMAPs/
├── backend/           # 后端（FastAPI + Python）
├── frontend/          # 前端（Vue 3 + TypeScript）
├── docs/              # 文档（结构、部署、功能说明）
├── start.py           # 统一启动脚本
├── start.bat / start.sh
└── README.md
```

- **后端**：所有 API、数据库、认证、业务逻辑均在 `backend/`。
- **前端**：所有页面、组件、状态、请求封装均在 `frontend/`。
- **文档**：`docs/` 内说明结构、部署与扩展方式。

---

## 二、后端结构（backend/）

```
backend/
├── app/
│   ├── main.py              # 应用入口，注册路由与中间件
│   ├── core/                 # 核心配置与基础设施
│   │   ├── config.py         # 配置（环境变量等）
│   │   ├── database.py      # 数据库连接
│   │   └── security.py      # JWT、密码等安全相关
│   ├── api/                  # 顶层 API 路由挂载（可选，当前由 main 直接挂载 modules）
│   ├── models/               # 全局/共享数据模型
│   ├── schemas/              # 全局 Pydantic 模型
│   ├── services/             # 共享业务服务
│   ├── utils/                # 工具函数
│   └── modules/              # 按业务划分的功能模块 ★
│       ├── auth/             # 认证（登录、用户信息）
│       ├── erp/              # ERP（订单、销售、采购、库存等）
│       ├── aps/               # 生产计划/排程
│       ├── mes/               # 制造执行/质量
│       └── websocket/         # WebSocket
├── database/
│   ├── init/                 # 初始化 SQL
│   └── migrations/           # 迁移脚本
├── requirements.txt
└── env.example
```

- **业务功能**一律放在 `app/modules/<模块名>/`，每个模块内可包含：
  - `api.py`：路由与接口
  - `models.py` / `schemas.py`：本模块模型与 DTO
  - 其他本模块专用文件

---

## 三、前端结构（frontend/）

```
frontend/
├── src/
│   ├── main.ts               # 应用入口
│   ├── App.vue
│   ├── shared/               # 全局共享 ★
│   │   ├── api/
│   │   │   └── request.ts    # 唯一 Axios 实例（推荐所有请求经此）
│   │   └── router/
│   │       └── index.ts      # 唯一路由定义（所有页面在此注册）
│   ├── modules/              # 按业务划分的模块（与后端对应）
│   │   ├── auth/             # 认证
│   │   │   ├── api.ts
│   │   │   ├── stores/user.ts
│   │   │   └── views/Login.vue
│   │   ├── erp/              # ERP 基础视图（Sales, Purchase, Inventory）
│   │   │   └── views/
│   │   ├── aps/
│   │   │   └── views/
│   │   ├── mes/
│   │   │   └── views/
│   │   └── websocket/
│   │       └── utils.ts
│   ├── views/                # 页面级视图（含子模块页面）
│   │   ├── Home.vue, Login.vue, Dashboard.vue
│   │   ├── aps/, mes/        # 与 modules 对应时可二选一或共存
│   │   └── erp/
│   │       ├── Sales.vue, Purchase.vue, Inventory.vue
│   │       └── order/        # 受注管理子模块（页面 + components）
│   │           ├── OrderHome.vue, OrderMonthlyList.vue, ...
│   │           └── components/
│   ├── api/                  # 按领域聚合的 API 封装（可选）
│   │   ├── request.ts        # → 统一 re-export 自 shared/api/request
│   │   ├── auth.ts
│   │   ├── order.ts          # 受注相关 API
│   │   └── order/order.ts    # 兼容 @/api/order/order 引用
│   ├── router/               # 备用/历史路由（实际入口为 shared/router）
│   ├── stores/               # 全局 store（若与 modules 内重复可逐步收敛到 modules）
│   └── utils/                # 工具（如 request 的 re-export、websocket 等）
├── index.html
├── package.json
├── vite.config.ts
└── env.example
```

- **路由**：只维护 `shared/router/index.ts`，新页面在此注册。
- **请求**：新接口推荐用 `import request from '@/shared/api/request'`，模块内 API 可放在 `api/` 或 `modules/<模块>/api.ts`。
- **视图**：通用页放在 `views/`，受注等子模块放在 `views/erp/order/`，组件放在对应 `components/`。

---

## 四、以后如何追加功能

### 1. 新增一个独立业务模块（如「报表」）

**后端**

1. 在 `backend/app/modules/` 下新建目录，例如 `report/`。
2. 新建 `__init__.py`、`api.py`（以及可选的 `models.py`、`schemas.py`）。
3. 在 `app/main.py` 中挂载路由，例如：
   - `from app.modules import report`
   - `app.include_router(report.router, prefix="/api/report", tags=["报表"])`

**前端**

1. 在 `frontend/src/modules/` 下新建 `report/`（或仅用 `views/report/` 也可，与现有习惯一致即可）。
2. 如需状态：在 `modules/report/` 下加 `stores/` 或 `api.ts`。
3. 在 `shared/router/index.ts` 中增加对应路由，指向新页面组件。

### 2. 在现有模块下追加功能（如在 ERP 下加「合同」）

**后端**

- 在 `backend/app/modules/erp/` 内增加接口与模型（或拆成子目录如 `erp/contract/` 再在 erp 的 router 中挂载）。

**前端**

- 在 `views/erp/` 下增加页面（如 `ContractList.vue`），或在 `views/erp/order/` 同级建 `views/erp/contract/`。
- 在 `shared/router/index.ts` 的 `/erp` 的 `children` 里增加 path 与 component。

### 3. 约定小结

| 操作           | 后端位置                     | 前端位置                          |
|----------------|------------------------------|-----------------------------------|
| 新业务模块     | `app/modules/<新模块>/`      | `modules/<新模块>/` + `shared/router` |
| 新 API         | 对应模块的 `api.py`          | `api/<领域>.ts` 或 `modules/xxx/api.ts` |
| 新页面/路由    | -                            | `views/` 或 `modules/xxx/views/` + `shared/router` |
| 全局请求/路由  | -                            | `shared/api/request.ts`、`shared/router/index.ts` |

按上述方式保持「前后端分离、模块清晰、入口统一」，后续扩展时只需在对应模块和 `shared/router` 中追加即可。
